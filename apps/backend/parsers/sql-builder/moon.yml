$schema: https://moonrepo.dev/schemas/project.json

project:
    name: sql-builder
    description: A Python gRPC service that constructs complete SQL statements from individual DDL expressions and column metadata. This service is responsible for assembling final CREATE TABLE and INSERT statements by managing dependencies and execution order of SQL expressions.

type: application

language: python

toolchain:
    python:
        version: "3.12.10"

tasks:
    test:
        command: uv
        args:
            - run
            - pytest
            - -v
            - -n
            - auto
            - --cov=src
            - --cov-report=term-missing
            - --cov-report=html
            - --cov-report=xml
        toolchain: python

    uv:
        command: uv
        toolchain: python
        options:
            runFromWorkspaceRoot: false
            cache: false

    run:
        command: uv
        args:
            - run
            - python
            - -m
            - src.server
        toolchain: python
        local: true

    docker-build:
        command: docker
        args:
            - build
            - -f
            - ./apps/backend/parsers/sql-builder/Dockerfile
            - .
        options:
            runFromWorkspaceRoot: true
