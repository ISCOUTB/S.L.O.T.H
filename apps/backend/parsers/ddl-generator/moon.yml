$schema: https://moonrepo.dev/schemas/project.json

project:
    name: ddl-generator
    description: A Python gRPC service that converts Excel formula Abstract Syntax Trees (AST) into SQL expressions. This service is responsible for translating the hierarchical structure of Excel formulas into equivalent SQL statements that can be used in database queries.

type: application

language: python

toolchain:
    python:
        version: "3.12.10"

tasks:
    test:
        command: uv
        args:
            - run
            - pytest
            - -v
            - -n
            - auto
            - --cov=src
            - --cov-report=term-missing
            - --cov-report=html
            - --cov-report=xml
        toolchain: python

    uv:
        command: uv
        toolchain: python
        options:
            runFromWorkspaceRoot: false
            cache: false

    run:
        command: uv
        args:
            - run
            - python
            - -m
            - src.server
        toolchain: python
        local: true

    docker-build:
        command: docker
        args:
            - build
            - -t
            - ddl-generator:latest
            - -f
            - ./apps/backend/parsers/ddl-generator/Dockerfile
            - .
        options:
            runFromWorkspaceRoot: true
