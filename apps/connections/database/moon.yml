$schema: https://moonrepo.dev/schemas/project.json

project:
  name: Database Connections
  description: A Python gRPC service that manages database connections and schema versions for various databases (MongoDB and Redis), including MongoDB, Redis, and SQL databases. This service handles the storage, retrieval, and versioning of database schemas, ensuring that applications can interact with databases using the correct schema definitions.

type: application

language: python

toolchain:
  python:
    version: "3.12.10"

tasks:
  run:
    command: uv
    args:
      - run
      - src/server.py
    toolchain: python
    local: true
    options:
      runFromWorkspaceRoot: false

  test:
    command: uv
    args:
      - run
      - pytest
      - -v
      - -n
      - auto
      - --cov=src
      - --cov-report=term-missing
      - --cov-report=html
      - --cov-report=xml
    options:
      runFromWorkspaceRoot: false

  format:
    command: uv
    args:
      - run
      - ruff
      - format
      - .
    options:
      runFromWorkspaceRoot: false

  docker-build:
    command: docker
    args:
      - build
      - -f
      - apps/connections/database/Dockerfile
      - .
      - -t
      - database:1.0
    options:
      runFromWorkspaceRoot: true
